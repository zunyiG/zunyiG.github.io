<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>高阶函数 | Keep learning</title>
    <meta name="description" content="keep learning">
    
    
    <link rel="preload" href="/assets/css/0.styles.ef148202.css" as="style"><link rel="preload" href="/assets/js/app.67e7f428.js" as="script"><link rel="preload" href="/assets/js/21.b7b4380c.js" as="script"><link rel="prefetch" href="/assets/js/10.9e81d398.js"><link rel="prefetch" href="/assets/js/11.677d4ba6.js"><link rel="prefetch" href="/assets/js/12.51d6780b.js"><link rel="prefetch" href="/assets/js/13.a1724e18.js"><link rel="prefetch" href="/assets/js/14.28dd4294.js"><link rel="prefetch" href="/assets/js/15.f2a7689f.js"><link rel="prefetch" href="/assets/js/16.cd9f0474.js"><link rel="prefetch" href="/assets/js/17.3640e356.js"><link rel="prefetch" href="/assets/js/18.0e89fc94.js"><link rel="prefetch" href="/assets/js/19.660c385c.js"><link rel="prefetch" href="/assets/js/2.c18e3c75.js"><link rel="prefetch" href="/assets/js/20.a70e4495.js"><link rel="prefetch" href="/assets/js/22.7fe8571d.js"><link rel="prefetch" href="/assets/js/23.9c246f12.js"><link rel="prefetch" href="/assets/js/24.4ebab5c7.js"><link rel="prefetch" href="/assets/js/25.e0f6c8dc.js"><link rel="prefetch" href="/assets/js/26.667a1084.js"><link rel="prefetch" href="/assets/js/27.484b1e43.js"><link rel="prefetch" href="/assets/js/28.e08b6058.js"><link rel="prefetch" href="/assets/js/29.0901b7fb.js"><link rel="prefetch" href="/assets/js/3.1660a1d9.js"><link rel="prefetch" href="/assets/js/30.5c5cb9f5.js"><link rel="prefetch" href="/assets/js/31.381f1dec.js"><link rel="prefetch" href="/assets/js/32.8f68533f.js"><link rel="prefetch" href="/assets/js/33.74cd6521.js"><link rel="prefetch" href="/assets/js/34.9d137b36.js"><link rel="prefetch" href="/assets/js/35.50b3f97d.js"><link rel="prefetch" href="/assets/js/36.1ba216f1.js"><link rel="prefetch" href="/assets/js/37.39b36aaf.js"><link rel="prefetch" href="/assets/js/38.d86ece5f.js"><link rel="prefetch" href="/assets/js/39.ed51f794.js"><link rel="prefetch" href="/assets/js/4.46657140.js"><link rel="prefetch" href="/assets/js/40.d1f5f3e3.js"><link rel="prefetch" href="/assets/js/41.cfb412eb.js"><link rel="prefetch" href="/assets/js/42.4e699448.js"><link rel="prefetch" href="/assets/js/43.e22ec204.js"><link rel="prefetch" href="/assets/js/44.0421ffff.js"><link rel="prefetch" href="/assets/js/45.58b817ec.js"><link rel="prefetch" href="/assets/js/46.541083b5.js"><link rel="prefetch" href="/assets/js/5.12d27dc6.js"><link rel="prefetch" href="/assets/js/6.25c40935.js"><link rel="prefetch" href="/assets/js/7.0b9bcdd6.js"><link rel="prefetch" href="/assets/js/8.c8621244.js"><link rel="prefetch" href="/assets/js/9.5e4b7b3b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ef148202.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Keep learning</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/haskell/" class="sidebar-link">简介</a></li><li><a href="/haskell/01.types.html" class="sidebar-link">基础类型</a></li><li><a href="/haskell/02.typeclass.html" class="sidebar-link">类型签名</a></li><li><a href="/haskell/03.function.html" class="sidebar-link">函数语法</a></li><li><a href="/haskell/04.recursion.html" class="sidebar-link">递归</a></li><li><a href="/haskell/05.high-order.html" class="active sidebar-link">高阶函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/haskell/05.high-order.html#科里化（curried）" class="sidebar-link">科里化（curried）</a></li><li class="sidebar-sub-header"><a href="/haskell/05.high-order.html#示例" class="sidebar-link">示例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/haskell/05.high-order.html#zipwith" class="sidebar-link">zipWith</a></li><li class="sidebar-sub-header"><a href="/haskell/05.high-order.html#flip" class="sidebar-link">flip</a></li></ul></li><li class="sidebar-sub-header"><a href="/haskell/05.high-order.html#map-与-filter" class="sidebar-link">map 与 filter</a></li><li class="sidebar-sub-header"><a href="/haskell/05.high-order.html#lambda-（匿名函数）" class="sidebar-link">lambda （匿名函数）</a></li><li class="sidebar-sub-header"><a href="/haskell/05.high-order.html#fold-reduce" class="sidebar-link">fold (reduce)</a></li><li class="sidebar-sub-header"><a href="/haskell/05.high-order.html#函数" class="sidebar-link">函数 $</a></li><li class="sidebar-sub-header"><a href="/haskell/05.high-order.html#组合-composition" class="sidebar-link">组合 composition</a></li></ul></li><li><a href="/haskell/06.module.html" class="sidebar-link">模块</a></li><li><a href="/haskell/07.build-typeclass.html" class="sidebar-link">构建 类型 类型类</a></li><li><a href="/haskell/08.input-output.html" class="sidebar-link">输入输出</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="高阶函数"><a href="#高阶函数" aria-hidden="true" class="header-anchor">#</a> 高阶函数</h1> <p>如果一个函数接收函数作为参数或者返回一个函数，我们称这样的函数为高阶函数。</p> <h2 id="科里化（curried）"><a href="#科里化（curried）" aria-hidden="true" class="header-anchor">#</a> 科里化（curried）</h2> <p>本质上，haskell的所有函数都只有一个参数，所看到的多参数函数都是科里化函数</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span> <span class="token operator">&gt;</span> <span class="token builtin">max</span> <span class="token number">4</span> <span class="token number">5</span>
<span class="token operator">=&gt;</span> <span class="token number">5</span>

<span class="token hvariable">ghci</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token builtin">max</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">5</span>
<span class="token operator">=&gt;</span> <span class="token number">5</span>
</code></pre></div><p>把空格放到两个东西之间，我们称之为函数调用，它类似于运算符，并拥有最高优先级。<br>
max :: (Ord a) =&gt; a -&gt; a -&gt; a, 也可以写作 max :: (Ord a) =&gt; a -&gt; (a -&gt; a) 即max传入一个参数将返回一个函数<br>
这就是为什么用 -&gt; 来分割参数和返回值<br>
这样的好处就是，可以极大的方便我们通过传入不完全的参数来构建新的函数。</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">add_two</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token hvariable">ghci</span> <span class="token operator">&gt;</span> <span class="token hvariable">add_two</span> <span class="token number">1</span>
<span class="token operator">=&gt;</span> <span class="token number">3</span>

<span class="token hvariable">compareWithHundred</span> <span class="token operator">=</span> <span class="token builtin">compare</span> <span class="token number">100</span>

<span class="token hvariable">isUpperCase</span> <span class="token operator">=</span> <span class="token punctuation">(</span>`<span class="token builtin">elem</span>` <span class="token punctuation">[</span><span class="token char">'A'</span><span class="token operator">..</span><span class="token char">'Z'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="示例"><a href="#示例" aria-hidden="true" class="header-anchor">#</a> 示例</h2> <h3 id="zipwith"><a href="#zipwith" aria-hidden="true" class="header-anchor">#</a> zipWith</h3> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token builtin">zipWith</span>' <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span> <span class="token operator">-&gt;</span> <span class="token hvariable">c</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">b</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">c</span><span class="token punctuation">]</span>
<span class="token builtin">zipWith</span>' <span class="token hvariable">_</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token hvariable">_</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token builtin">zipWith</span>' <span class="token hvariable">_</span> <span class="token hvariable">_</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token builtin">zipWith</span>' <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token operator">:</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">y</span><span class="token operator">:</span> <span class="token hvariable">ys</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">f</span> <span class="token hvariable">x</span> <span class="token hvariable">y</span> <span class="token operator">:</span> <span class="token builtin">zipWith</span>' <span class="token hvariable">f</span> <span class="token hvariable">xs</span> <span class="token hvariable">ys</span>
</code></pre></div><p>函数的第一个参数是一个函数 第二、三个参数是一个list，<br>
并且第一个list的类型a必须和第一个函数参数的a相同，第二个list的类型b必须和第二个函数参数的b相同<br>
如果说第一个函数类型是 <code>a -&gt; b -&gt; c</code>，而传入的类型是 <code>a -&gt; a -&gt; c</code> 这样是可以的，但是反之就不行</p> <p>高阶函数拥有强大的抽象能力，只需简单的组合就可以发挥强大的作用</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">zipWith</span>' <span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span>  
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">zipWith</span>' <span class="token builtin">max</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>  
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">zipWith</span>' <span class="token punctuation">(</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token string">&quot;foo &quot;</span>，<span class="token string">&quot;bar &quot;</span>，<span class="token string">&quot;baz &quot;</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token string">&quot;fighters&quot;</span>，<span class="token string">&quot;hoppers&quot;</span>，<span class="token string">&quot;aldrin&quot;</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token string">&quot;foo fighters&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;bar hoppers&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;baz aldrin&quot;</span><span class="token punctuation">]</span>  
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">zipWith</span>' <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">replicate</span> <span class="token number">5</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span>  
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">zipWith</span>' <span class="token punctuation">(</span><span class="token builtin">zipWith</span>' <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><h3 id="flip"><a href="#flip" aria-hidden="true" class="header-anchor">#</a> flip</h3> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token builtin">flip</span>' <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span> <span class="token operator">-&gt;</span> <span class="token hvariable">c</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">b</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">c</span><span class="token punctuation">)</span>  
<span class="token builtin">flip</span>' <span class="token hvariable">f</span> <span class="token operator">=</span> <span class="token hvariable">g</span>  
    <span class="token keyword">where</span> <span class="token hvariable">g</span> <span class="token hvariable">x</span> <span class="token hvariable">y</span> <span class="token operator">=</span> <span class="token hvariable">f</span> <span class="token hvariable">y</span> <span class="token hvariable">x</span>
</code></pre></div><p>由于haskell中函数都是科里化的， 所以 <code>(a -&gt; b -&gt; c) -&gt; (b -&gt; a -&gt; c)</code> 等价于 <code>(a -&gt; b -&gt; c) -&gt; (b -&gt; (a -&gt; c))</code><br>
就等价于 <code>(a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c</code>, 所以我们也可以写成：</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token builtin">flip</span>' <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span> <span class="token operator">-&gt;</span> <span class="token hvariable">c</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">c</span>  
<span class="token builtin">flip</span>' <span class="token hvariable">f</span> <span class="token hvariable">y</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token hvariable">f</span> <span class="token hvariable">x</span> <span class="token hvariable">y</span>
</code></pre></div><div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">flip</span>' <span class="token builtin">zip</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token string">&quot;hello&quot;</span>  
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token char">'h'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token char">'e'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token char">'l'</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token char">'l'</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token char">'o'</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">zipWith</span> <span class="token punctuation">(</span><span class="token builtin">flip</span>' <span class="token builtin">div</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">..</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
</code></pre></div><h2 id="map-与-filter"><a href="#map-与-filter" aria-hidden="true" class="header-anchor">#</a> map 与 filter</h2> <p>map 取一个函数和 List 做参数，遍历该 List 的每个元素来调用该函数产生一个新的 List</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token builtin">map</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">b</span><span class="token punctuation">]</span>  
<span class="token builtin">map</span> <span class="token hvariable">_</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  
<span class="token builtin">map</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token operator">:</span><span class="token hvariable">xs</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token hvariable">f</span> <span class="token hvariable">x</span> <span class="token operator">:</span> <span class="token builtin">map</span> <span class="token hvariable">f</span> <span class="token hvariable">xs</span>
</code></pre></div><p>它其实与 List Comprehension 有相似之处，map (+3) [1,5,3,1,6] 与 [x+3 | x &lt;- [1,5,3,1,6] 完全等价。</p> <p>filter 函数取一个限制条件和一个 List，回传该 List 中所有符合该条件的元素</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token builtin">filter</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token constant">Bool</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span>
<span class="token builtin">filter</span> <span class="token hvariable">_</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token builtin">filter</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token operator">:</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span>
  <span class="token operator">|</span> <span class="token hvariable">f</span> <span class="token hvariable">x</span>       <span class="token operator">=</span> <span class="token hvariable">x</span> <span class="token operator">:</span> <span class="token builtin">filter</span> <span class="token hvariable">f</span> <span class="token hvariable">xs</span>
  <span class="token operator">|</span> <span class="token builtin">otherwise</span> <span class="token operator">=</span> <span class="token builtin">filter</span> <span class="token hvariable">f</span> <span class="token hvariable">xs</span>
</code></pre></div><p>什么情况下用 map 和 filter 还是 List Comprehension，选择权归你，看谁舒服用谁就是。 如果有多个限制条件，只能连着套好几个 filter 或用 &amp;&amp; 等逻辑函数的组合之，这时就不如 List comprehension 来得爽了</p> <p>quickSort 的 filter写法</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">quicksort</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Ord</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span>
<span class="token hvariable">quicksort</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token hvariable">quicksort</span> <span class="token punctuation">(</span><span class="token hvariable">x</span><span class="token operator">:</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span> <span class="token operator">=</span>
  <span class="token keyword">let</span> <span class="token hvariable">smallerSorted</span> <span class="token operator">=</span> <span class="token hvariable">quicksort</span> <span class="token punctuation">(</span><span class="token builtin">filter</span> <span class="token punctuation">(</span><span class="token operator">&lt;=</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span>
      <span class="token hvariable">biggerSorted</span> <span class="token operator">=</span> <span class="token hvariable">quicksort</span> <span class="token punctuation">(</span><span class="token builtin">filter</span> <span class="token punctuation">(</span><span class="token operator">&gt;</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span>
  <span class="token keyword">in</span> <span class="token hvariable">smallerSorted</span> <span class="token operator">++</span> <span class="token punctuation">[</span><span class="token hvariable">x</span><span class="token punctuation">]</span> <span class="token operator">++</span> <span class="token hvariable">biggerSorted</span>
</code></pre></div><p>更多用法</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">largestDivisible</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Integral</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token hvariable">a</span>  
<span class="token hvariable">largestDivisible</span> <span class="token operator">=</span> <span class="token builtin">head</span> <span class="token punctuation">(</span><span class="token builtin">filter</span> <span class="token hvariable">p</span> <span class="token punctuation">[</span><span class="token number">100000</span><span class="token punctuation">,</span><span class="token number">99999</span><span class="token operator">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  
    <span class="token keyword">where</span> <span class="token hvariable">p</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token hvariable">x</span> `<span class="token builtin">mod</span>` <span class="token number">3829</span> <span class="token operator">==</span> <span class="token number">0</span>
</code></pre></div><p>takeWhile 它取一个限制条件和 List 作参数，然后从头开始遍历这一 List，并返回符合限制条件的元素。 而一旦遇到不符合条件的元素，就停止。<br>
求所有小于 10000 的奇数的平方的和:</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">sum</span> <span class="token punctuation">(</span><span class="token builtin">takeWhile</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">filter</span> <span class="token builtin">odd</span> <span class="token punctuation">(</span><span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token operator">=&gt;</span> <span class="token number">166650</span>
</code></pre></div><p>Collatz序列 取一个自然数，若为偶数就除以 2。 若为奇数就乘以 3 再加 1。 再用相同的方式处理所得的结果，得到一组数字构成的的链。它有个性质，无论任何以任何数字开始，最终的结果都会归 1。</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">collatz_chain</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Integral</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span>
<span class="token hvariable">collatz_chain</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token hvariable">collatz_chain</span> <span class="token hvariable">n</span>
  <span class="token operator">|</span> <span class="token builtin">odd</span> <span class="token hvariable">n</span> <span class="token operator">=</span> <span class="token hvariable">n</span> <span class="token operator">:</span> <span class="token hvariable">collatz_chain</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token number">3</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token operator">|</span> <span class="token builtin">otherwise</span> <span class="token operator">=</span> <span class="token hvariable">n</span> <span class="token operator">:</span> <span class="token hvariable">collatz_chain</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> `<span class="token builtin">div</span>` <span class="token number">2</span><span class="token punctuation">)</span>

<span class="token hvariable">numLongChains</span> <span class="token operator">::</span> <span class="token constant">Int</span>  
<span class="token hvariable">numLongChains</span> <span class="token operator">=</span> <span class="token builtin">length</span> <span class="token punctuation">(</span><span class="token builtin">filter</span> <span class="token hvariable">isLong</span> <span class="token punctuation">(</span><span class="token builtin">map</span> <span class="token hvariable">chain</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
    <span class="token keyword">where</span> <span class="token hvariable">isLong</span> <span class="token hvariable">xs</span> <span class="token operator">=</span> <span class="token builtin">length</span> <span class="token hvariable">xs</span> <span class="token operator">&gt;</span> <span class="token number">15</span>
</code></pre></div><div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token keyword">let</span> <span class="token hvariable">listOfFuns</span> <span class="token operator">=</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">..</span><span class="token punctuation">]</span>  
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">listOfFuns</span> <span class="token operator">!!</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token number">5</span>  
<span class="token number">20</span>
</code></pre></div><p>取所得 List 的第五个元素可得一函数，与 (<em>4) 等价。 然后用 5 调用它，与 (</em> 4) 5 或 4*5 都是等价的.</p> <h2 id="lambda-（匿名函数）"><a href="#lambda-（匿名函数）" aria-hidden="true" class="header-anchor">#</a> lambda （匿名函数）</h2> <p>lambda 就是匿名函数。有些时候我们需要传给高阶函数一个函数，而这函数我们只会使用这一次</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token operator">\</span> <span class="token hvariable">x</span> <span class="token operator">-&gt;</span> <span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token operator">=&gt;</span> <span class="token number">2</span>
</code></pre></div><p>不熟悉科里化往往会写出一些没必要的 lambda。<br>
例如，表达式 <code>map (+3) [1,6,3,2]</code> 与 <code>map (\x -&gt; x+3) [1,6,3,2]</code> 等价, 所以上面的可以改成：</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token operator">=&gt;</span> <span class="token number">2</span>
</code></pre></div><p>lambda 也可以取多个参数。</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">zipWith</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">a</span> <span class="token hvariable">b</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">*</span> <span class="token number">30</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token number">153.0</span><span class="token punctuation">,</span><span class="token number">61.5</span><span class="token punctuation">,</span><span class="token number">31.0</span><span class="token punctuation">,</span><span class="token number">15.75</span><span class="token punctuation">,</span><span class="token number">6.6</span><span class="token punctuation">]</span>
</code></pre></div><p>可以在 lambda 中使用模式匹配, lambda 的模式匹配若失败，就会引发一个运行时错误，所以慎用！</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token punctuation">(</span><span class="token hvariable">a</span><span class="token punctuation">,</span><span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">+</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">]</span>
</code></pre></div><p>一般情况下，lambda 都是括在括号中，除非我们想要后面的整个语句都作为 lambda 的函数体。很有趣，由于有柯里化，如下的两段是等价的：</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">addThree</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Num</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span>  
<span class="token hvariable">addThree</span> <span class="token hvariable">x</span> <span class="token hvariable">y</span> <span class="token hvariable">z</span> <span class="token operator">=</span> <span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token hvariable">y</span> <span class="token operator">+</span> <span class="token hvariable">z</span>

<span class="token hvariable">addThree</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Num</span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span>  
<span class="token hvariable">addThree</span> <span class="token operator">=</span> <span class="token operator">\</span><span class="token hvariable">x</span> <span class="token operator">-&gt;</span> <span class="token operator">\</span><span class="token hvariable">y</span> <span class="token operator">-&gt;</span> <span class="token operator">\</span><span class="token hvariable">z</span> <span class="token operator">-&gt;</span> <span class="token hvariable">x</span> <span class="token operator">+</span> <span class="token hvariable">y</span> <span class="token operator">+</span> <span class="token hvariable">z</span>
</code></pre></div><h2 id="fold-reduce"><a href="#fold-reduce" aria-hidden="true" class="header-anchor">#</a> fold (reduce)</h2> <p>fold 有两个参数，即累加值和 List 的首项(或尾项)，返回值是新的累加值<br>
foldl 函数，也叫做左累加</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span> <span class="token operator">&gt;</span> <span class="token builtin">foldl</span> <span class="token punctuation">(</span><span class="token operator">\</span> <span class="token hvariable">acc</span> <span class="token hvariable">x</span> <span class="token operator">-&gt;</span> <span class="token hvariable">acc</span> <span class="token operator">+</span> <span class="token hvariable">x</span><span class="token punctuation">)</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token operator">=&gt;</span> <span class="token number">15</span>
</code></pre></div><p>上面也可以简写为： <code>foldl (+) 0 [1,2,3,4,5]</code></p> <p>右累加 foldr 的行为与左累加相似，只是累加值是从 List 的右边开始</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token builtin">map</span>' <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">a</span><span class="token punctuation">]</span> <span class="token operator">-&gt;</span> <span class="token punctuation">[</span><span class="token hvariable">b</span><span class="token punctuation">]</span>  
<span class="token builtin">map</span>' <span class="token hvariable">f</span> <span class="token hvariable">xs</span> <span class="token operator">=</span> <span class="token builtin">foldr</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">x</span> <span class="token hvariable">acc</span> <span class="token operator">-&gt;</span> <span class="token hvariable">f</span> <span class="token hvariable">x</span> <span class="token operator">:</span> <span class="token hvariable">acc</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token hvariable">xs</span>
</code></pre></div><p>我们也可以用左折叠来实现它，<code>map' f xs = foldl (\acc x -&gt; acc ++ [f x]) [] xs 。</code>
不过问题是，使用 <code>(++)</code> 往 List 后面追加元素的效率要比使用 <code>(:)</code> 低得多。所以在生成新 List 的时候人们一般都是使用右折叠。</p> <p><code>foldl1</code> 与 <code>foldr1</code> 的行为与 foldl 和 foldr 相似，只是你无需明确提供初始值。他们假定 List 的首个(或末尾)元素作为起始值，并从旁边的元素开始</p> <p>scanl 和 scanr 与 foldl 和 foldr 相似，只是它们会记录下累加值的所有状态到一个 List。也有 scanl1 和 scanr1。</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">scanl</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">]</span>  
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">scanr</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token number">0</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>  
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">scanl1</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">acc</span> <span class="token hvariable">x</span> <span class="token operator">-&gt;</span> <span class="token keyword">if</span> <span class="token hvariable">x</span> <span class="token operator">&gt;</span> <span class="token hvariable">acc</span> <span class="token keyword">then</span> <span class="token hvariable">x</span> <span class="token keyword">else</span> <span class="token hvariable">acc</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">]</span>  
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">scanl</span> <span class="token punctuation">(</span><span class="token builtin">flip</span> <span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
</code></pre></div><p>scan 可以用来跟踪 fold 函数的运行过程。</p> <h2 id="函数"><a href="#函数" aria-hidden="true" class="header-anchor">#</a> 函数 $</h2> <p><code>$</code> 可以改变函数运算的优先级，可以帮助减少代码中的括号。<code>sum (map sqrt [1..130])</code> 可以改为 <code>sum $ map sqrt [1..130]</code></p> <p>$ 还可以将数据作为函数使用。例如映射一个函数调用符到一组函数组成的 List：</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">$</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token builtin">sqrt</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token number">7.0</span><span class="token punctuation">,</span><span class="token number">30.0</span><span class="token punctuation">,</span><span class="token number">9.0</span><span class="token punctuation">,</span><span class="token number">1.7320508075688772</span><span class="token punctuation">]</span>
</code></pre></div><h2 id="组合-composition"><a href="#组合-composition" aria-hidden="true" class="header-anchor">#</a> 组合 composition</h2> <p>函数组合表示组合两个函数成为一个函数。以 x 调用这一函数，就与用 x 调用 g 再用所得的结果调用 f 等价。</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">b</span> <span class="token operator">-&gt;</span> <span class="token hvariable">c</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">b</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token hvariable">a</span> <span class="token operator">-&gt;</span> <span class="token hvariable">c</span>

<span class="token hvariable">f</span><span class="token operator"> . </span><span class="token hvariable">g</span> <span class="token operator">=</span> <span class="token operator">\</span> <span class="token hvariable">x</span> <span class="token operator">-&gt;</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">g</span> <span class="token hvariable">x</span><span class="token punctuation">)</span>
</code></pre></div><p>negate . (*3) 回传一个求一数字乘以 3 后的负数的函数
假设我们有一组由数字组成的 List，要将其全部转为负数，很容易就想到应先取其绝对值，再取负数，像这样：</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">x</span> <span class="token operator">-&gt;</span> <span class="token builtin">negate</span> <span class="token punctuation">(</span><span class="token builtin">abs</span> <span class="token hvariable">x</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">]</span>
<span class="token comment">-- 可以改为</span>
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token builtin">negate</span><span class="token operator"> . </span><span class="token builtin">abs</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token number">24</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">19</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">]</span>
</code></pre></div><div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">xs</span> <span class="token operator">-&gt;</span> <span class="token builtin">negate</span> <span class="token punctuation">(</span><span class="token builtin">sum</span> <span class="token punctuation">(</span><span class="token builtin">tail</span> <span class="token hvariable">xs</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">..</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">27</span><span class="token punctuation">]</span>
<span class="token comment">-- 可以改为</span>
<span class="token hvariable">ghci</span><span class="token operator">&gt;</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token builtin">negate</span><span class="token operator"> . </span><span class="token builtin">sum</span><span class="token operator"> . </span><span class="token builtin">tail</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">..</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  
<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">27</span><span class="token punctuation">]</span>
</code></pre></div><p>含多个参数的函数，可以使用不全调用使每个函数都只剩下一个参数</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">ghci</span> <span class="token operator">&gt;</span> <span class="token builtin">sum</span> <span class="token punctuation">(</span><span class="token builtin">replicate</span> <span class="token number">5</span> <span class="token punctuation">(</span><span class="token builtin">max</span> <span class="token number">6.7</span> <span class="token number">8.9</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">-- 可以改为</span>
<span class="token hvariable">ghci</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token builtin">sum</span><span class="token operator"> . </span><span class="token builtin">replicate</span> <span class="token number">5</span><span class="token operator"> . </span><span class="token builtin">max</span> <span class="token number">6.7</span><span class="token punctuation">)</span> <span class="token number">8.9</span>
<span class="token comment">-- 或者</span>
<span class="token hvariable">ghci</span> <span class="token operator">&gt;</span> <span class="token builtin">sum</span><span class="token operator"> . </span><span class="token builtin">replicate</span> <span class="token number">5</span><span class="token operator"> . </span><span class="token builtin">max</span> <span class="token number">6.7</span> <span class="token operator">$</span> <span class="token number">8.9</span>
<span class="token comment">-- 用 8.9 调用 max 6.7，然后使它 replicate 5，再 sum 之</span>
<span class="token hvariable">ghci</span> <span class="token operator">&gt;</span> <span class="token builtin">replicate</span> <span class="token number">100</span> <span class="token punctuation">(</span><span class="token builtin">product</span> <span class="token punctuation">(</span><span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">zipWith</span> <span class="token builtin">max</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">-- 可以改为：</span>
<span class="token hvariable">ghci</span> <span class="token operator">&gt;</span> <span class="token builtin">replicate</span> <span class="token number">100</span><span class="token operator"> . </span><span class="token builtin">product</span><span class="token operator"> . </span><span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token operator"> . </span><span class="token builtin">zipWith</span> <span class="token builtin">max</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">$</span> <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span>
</code></pre></div><p>函数组合的另一用途就是定义 point free style (也称作 pointless style) 的函数</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token builtin">sum</span>' <span class="token hvariable">xs</span> <span class="token operator">=</span> <span class="token builtin">foldl</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token number">0</span> <span class="token hvariable">xs</span>
<span class="token comment">-- 可以改为</span>
<span class="token builtin">sum</span>' <span class="token operator">=</span> <span class="token builtin">foldl</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span> <span class="token number">0</span>

<span class="token hvariable">fn</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token builtin">ceiling</span> <span class="token punctuation">(</span><span class="token builtin">negate</span> <span class="token punctuation">(</span><span class="token builtin">tan</span> <span class="token punctuation">(</span><span class="token builtin">cos</span> <span class="token punctuation">(</span><span class="token builtin">max</span> <span class="token number">50</span> <span class="token hvariable">x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">-- 可以改为</span>
<span class="token hvariable">fn</span> <span class="token operator">=</span> <span class="token builtin">ceiling</span><span class="token operator"> . </span><span class="token builtin">negate</span><span class="token operator"> . </span><span class="token builtin">tan</span><span class="token operator"> . </span><span class="token builtin">cos</span><span class="token operator"> . </span><span class="token builtin">max</span> <span class="token number">50</span>
</code></pre></div><p>point free style 会令你去思考函数的组合方式，而非数据的传递方式，更加简洁明了。你可以将一组简单的函数组合在一起，使之形成一个复杂的函数</p> <p>不过函数若过于复杂，再使用 point free style 往往会适得其反，因此构造较长的函数组合链是不被鼓励的,<br>
更好的解决方法，就是使用 let 语句给中间的运算结果绑定一个名字，或者说把问题分解成几个小问题再组合到一起。</p> <p>前面 map 和 filter 那节中，我们求了小于 10000 的所有奇数的平方的和：</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">oddSquareSum</span> <span class="token operator">::</span> <span class="token constant">Integer</span>  
<span class="token hvariable">oddSquareSum</span> <span class="token operator">=</span> <span class="token builtin">sum</span> <span class="token punctuation">(</span><span class="token builtin">takeWhile</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">filter</span> <span class="token builtin">odd</span> <span class="token punctuation">(</span><span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>函数组合狂人，可能会这么写：</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">oddSquareSum</span> <span class="token operator">::</span> <span class="token constant">Integer</span>  
<span class="token hvariable">oddSquareSum</span> <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token operator"> . </span><span class="token builtin">takeWhile</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token operator"> . </span><span class="token builtin">filter</span> <span class="token builtin">odd</span><span class="token operator"> . </span><span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">$</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token punctuation">]</span>
</code></pre></div><p>不过代码是写给人看的，可能就会这么写了：</p> <div class="language-haskell extra-class"><pre class="language-haskell"><code><span class="token hvariable">oddSquareSum</span> <span class="token operator">::</span> <span class="token constant">Integer</span>  
<span class="token hvariable">oddSquareSum</span> <span class="token operator">=</span>
    <span class="token keyword">let</span> <span class="token hvariable">oddSquares</span> <span class="token operator">=</span> <span class="token builtin">filter</span> <span class="token builtin">odd</span> <span class="token operator">$</span> <span class="token builtin">map</span> <span class="token punctuation">(</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">..</span><span class="token punctuation">]</span>  
        <span class="token hvariable">belowLimit</span> <span class="token operator">=</span> <span class="token builtin">takeWhile</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span><span class="token number">10000</span><span class="token punctuation">)</span> <span class="token hvariable">oddSquares</span>  
    <span class="token keyword">in</span>  <span class="token builtin">sum</span> <span class="token hvariable">belowLimit</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/haskell/04.recursion.html" class="prev">
          递归
        </a></span> <span class="next"><a href="/haskell/06.module.html">
          模块
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.67e7f428.js" defer></script><script src="/assets/js/21.b7b4380c.js" defer></script>
  </body>
</html>
